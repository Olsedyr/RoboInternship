STATEMACHINEVERSION 2
Name=Pallebane3
Delaystop=10000000
Input=0,Foto1 "Pallebane3 Foto"
Input=1,FotoSecure "Pallebane3 FotoSecure"
Output=0,Motor "Pallebane3 Motor" 
Link=0,Pallebane4
Link=1,Pallebane1
Timeout=0,StopDelay 1000000
Timeout=1,TimeoutDelay 10000000
Timeout=2,StartupTimeout 5000000
Timeout=3,SafeTime 1500000
Value=0,errorCode 0

State=0,ST_HALT
  END

State=0,ST_TIMER
  END

State=0,ST_IDLE
  SET Motor 0
  END

State=1,ST_READY
  TEST Foto1 = 0
    SETSTATE ST_EMPTY
  ELSE
    TEST Pallebane4 = ST_EMPTY
      SET Motor 1
      TIMEOUT TimeoutDelay ST_RESET
      SETSTATE ST_SEND
    ELSE
      SET Motor 0
    ENDTEST
  ENDTEST
  TEST Pallebane1 = ST_IDLE
    SETSTATE ST_IDLE
  ENDTEST
END

State=2,ST_SEND
  TEST Pallebane4 = ST_PALLET_REV_TIMEOUT
    SETSTATE ST_EMPTY
  ELSE
    TEST TimeoutDelay = 1
      SETSTATE ST_RESET
    ELSE
      SET Motor 1
    ENDTEST
  ENDTEST
END

State=3,ST_EMPTY
  TEST Foto1 = 1 
    SETSTATE ST_READY
  ELSE 
    TEST Pallebane1 = ST_SEND 
      SET Motor 1
      TIMEOUT TimeoutDelay ST_RESET
      SETSTATE ST_RECIEVE
    ELSE 
      SET Motor 0
    ENDTEST
 ENDTEST
 TEST Pallebane1 = ST_IDLE
   SETSTATE ST_IDLE
 ENDTEST
END

State=4,ST_RECIEVE
  TEST Foto1 = 1
    SET Motor 0
    TIMEOUT SafeTime ST_CHECKSAFE
    SETSTATE ST_CHECKSAFE
  ELSE 
    TEST TimeoutDelay = 1
      SETSTATE ST_RESET
    ELSE
      SET Motor 1
    ENDTEST
  ENDTEST
END

State=6,ST_CHECKSAFE
  SET Motor 0
  TEST FotoSecure = 0
    SET errorCode 1009
    SETSTATE ST_IDLE
  ENDTEST
  TEST SafeTime = 1
    TEST FotoSecure = 1
    AND Foto1 = 1
      SETSTATE ST_READY      
    ENDTEST
  ENDTEST
 TEST Pallebane1 = ST_IDLE
   SETSTATE ST_IDLE
 ENDTEST
END

State=6,ST_RESET
  TEST Foto1 = 1
    SETSTATE ST_READY
  ELSE
    TIMEOUT StartupTimeout ST_STOP
    SETSTATE ST_STOP
    SET Motor 1
  ENDTEST
END

State=6,ST_STOP
  TEST Foto1 = 1
    SET Motor 0
    SETSTATE ST_READY
  ELSE
    TEST StartupTimeout = 1
      SET Motor 0
      SETSTATE ST_EMPTY
    ELSE
      SET Motor 1
    ENDTEST
  ENDTEST
  END

