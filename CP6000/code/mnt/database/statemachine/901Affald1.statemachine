STATEMACHINEVERSION 3
Name=Affald1
Output=motor "Affald 1 Motor"
Link=convemergency ConveyorsEmergency
Value=delayStop 0
Timeout=delayStopTime 6000000

State=ST_TIMER
END

State=ST_HALT
END

State=ST_IDLE
  SET motor 0
  TEST convemergency = ST_POWERON
		SETSTATE ST_RESET
	ENDTEST
END

State=ST_RESET
  SETSTATE ST_RUN
END

State=ST_RUN
  ;wait for external statemachine to set delayStop = 1
  TEST delayStop = 1
    SET motor 1
    SET delayStop 0
    TIMEOUT delayStopTime ST_DELAY_STOP
    SETSTATE ST_DELAY_STOP
  ENDTEST
  TEST convemergency = ST_POWEROFF
		SETSTATE ST_IDLE
	ENDTEST
END

State=ST_DELAY_STOP
  TEST delayStop = 1
    SET delayStop 0
    TIMEOUT delayStopTime ST_DELAY_STOP
    SETSTATE ST_DELAY_STOP
  ELSE
    TEST delayStopTime = 1
      SET motor 0
      SETSTATE ST_RUN
    ENDTEST
  ENDTEST
  TEST convemergency = ST_POWEROFF
		SETSTATE ST_IDLE
	ENDTEST
END
