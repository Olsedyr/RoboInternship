STATEMACHINEVERSION 2
Name=checkWeigherMotor
Input=0,printstop "PrinterStop"
Input=1,Endestop "ConveyorIn endestop"
Output=0,motor "checkWeigher motorEnable"
Output=1,motorProtect "checkWeigher motor"
Output=2,stopflow "stopFlowPakker"
Const=0,stopType 0
Const=1,one 1
Const=2,false 1
Const=3,true 0
Value=4,valmanuel 0
Link=0,checkWeigher
Link=1,fotoInBlocked
Link=2,UniChain
Timeout=0,stopDelay 2000000
Timeout=1,startDelay 4000000

State=0,ST_HALT
END

State=0,ST_ERROR
 SET motor 0 
 SET stopflow 1
END

State=0,ST_TIMER
END

State=0,ST_IDLE
  SET motor 0
  SET motorProtect 0  
END

State=5,ST_RESET
  SET motorProtect 1
  TEST Endestop = 0
    TEST checkWeigher = ST_WAIT_FOR_PRODUCT
      SET stopflow 0
      TIMEOUT startDelay ST_READY  
      SETSTATE ST_TIMER
    ENDTEST
  ELSE
    TEST valmanuel = one
      SETSTATE ST_MANUEL
		ELSE
			SETSTATE ST_MAN_NORUN
    ENDTEST
  ENDTEST
END

State=5,ST_MANUEL
  SET motor 1
END

State=5,ST_MAN_NORUN
  SET motor 0
  TEST UniChain = ST_IDLE
    SETSTATE ST_IDLE
  ENDTEST
END

State=5,ST_RESET_MANRUN
  SET valmanuel 1
END

State=5,ST_RESET_MANSTOP
  SET valmanuel 0
END

State=5,ST_READY
  SET motor 1
  TEST stopType = one  
    TEST checkWeigher = ST_ERROR
    OR checkWeigher = ST_PRODUCT_OUTSIDE
      SETSTATE ST_ERROR
    ENDTEST
  ELSE    
    TEST checkWeigher = ST_ERROR
      SETSTATE ST_ERROR
    ENDTEST
  ENDTEST
  TEST checkWeigher = ST_DO_CALIBRATE
  OR fotoInBlocked = ST_BLOCKED
    SET stopflow 1
  ENDTEST
  TEST UniChain = ST_IDLE
    TIMEOUT stopDelay ST_IDLE
    SETSTATE ST_TIMER
  ENDTEST
END
