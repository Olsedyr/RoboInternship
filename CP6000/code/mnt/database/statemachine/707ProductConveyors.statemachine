STATEMACHINEVERSION 3
Name=ProductConveyors
Delaystop=10000000
Input=powerok1 "ProduktConveyor_1 HZOK"
Input=powerok2 "ProduktConveyor_2 HZOK"
Output=Motor1Enable "ProductConveyor1 Motor Enable"
Output=Motor2Enable "ProductConveyor2 Motor Enable"
Output=Motor1Setpoint "ProductConveyor1 Setpoint"
Output=Motor2Setpoint "ProductConveyor2 Setpoint"
Link=Skubber LangBufferSkub
Link=Counter ProductCount
Link=CamGenSkub
Link=parent LangBufferSkub
linkValue=prenumofproducts ProductCount
linkValue=oldppp Counter
linkValue=productsfromleft Program
linkValue=productsfromright Program
Value=ppp 0
Const=motor1FreqForward -50.0000
Const=motor1FreqReverse 50.0000
Const=motor2FreqForward 40.0000
Const=motor2FreqReverse -40.0000
Timeout=TimeStop 0
Timeout=TimeRunAgain 100000

State=ST_TIMER
END

State=ST_HALT
END

State=ST_IDLE
	SET Motor1Enable 0
  SET Motor1Setpoint 0.0
	SET Motor2Enable 0
  SET Motor2Setpoint 0.0
	TEST parent = ST_RESET
		SETSTATE ST_RESET
	ENDTEST
END

State=ST_RESET
	SETSTATE ST_STARTUP
END

State=ST_STARTUP
	TEST Counter = ST_RUN
  OR Counter = ST_RUN_MANUELT
	  CALC ppp = oldppp + 1
	  TEST prenumofproducts >= ppp
		  SETSTATE ST_STOP
    ELSE
			TEST CamGenSkub != ST_NOCHOOSETRACK
				SETSTATE ST_RUN
			ENDTEST
    ENDTEST 
	ENDTEST
	TEST parent = ST_IDLE
		SETSTATE ST_IDLE
	ENDTEST
END

State=ST_RUN
	CALC ppp = oldppp + 1
	TEST prenumofproducts >= ppp
		TIMEOUT TimeStop ST_GOSTOP
		SETSTATE ST_GOSTOP
	ELSE
		TEST productsfromleft = 1
    AND productsfromright = 1
	    SET Motor1Enable 1
      SET Motor1Setpoint motor1FreqForward
			SET Motor2Enable 1
      SET Motor2Setpoint motor2FreqForward
		ELSE
      TEST productsfromleft = 1
	      SET Motor1Enable 1
        SET Motor1Setpoint motor1FreqForward
				SET Motor2Enable 1
				SET Motor2Setpoint motor2FreqForward
      ELSE
        TEST productsfromright = 1
	        SET Motor1Enable 1
          SET Motor1Setpoint motor1FreqReverse
					SET Motor2Enable 1
					SET Motor2Setpoint motor2FreqForward
        ENDTEST
      ENDTEST
		ENDTEST
	ENDTEST
  TEST powerok1 = 0
  OR powerok2 = 0
    SETSTATE ST_IDLE
  ENDTEST
	TEST parent = ST_IDLE
		SETSTATE ST_IDLE
	ENDTEST
END

State=ST_GOSTOP
	CALC ppp = oldppp + 1
	TEST TimeStop = 1
		SETSTATE ST_STOP
	ENDTEST
	TEST prenumofproducts < ppp
		SETSTATE ST_RUN
	ENDTEST
END

State=ST_STOP
	CALC ppp = oldppp + 1
	TEST prenumofproducts < ppp
		TIMEOUT TimeRunAgain ST_RUN
		SETSTATE ST_TIMER
	ELSE
	  SET Motor1Enable 0
    SET Motor1Setpoint 0.0
	  SET Motor2Enable 0
    SET Motor2Setpoint 0.0
	ENDTEST
	TEST parent = ST_IDLE
		SETSTATE ST_IDLE
	ENDTEST
END
