STATEMACHINEVERSION 3
; Include
Name=checkWeigherCalc
Input=celldata "LoadCell data"
Value=weight 0.0 
Table=fweight 100.0 AVG
Table=ffweight 100.0 AVG
Table=sampling 600.0
Value=samplingmaxidx 0
Value=raw 0.0
Value=wa 0.0
Const=scale 1.0
Const=capture 0
Const=sampleType 2
linkValue=newprogram Program
linkValue=fweightSize Program
linkValue=ffweightSize Program
linkValue=dynmodeoffset Program
linkValue=offset calibOffsetInit checkWeigher
linkValue=staticmode staticmode checkWeigher

State=ST_HALT
END

State=ST_TIMER
END

State=ST_IDLE
 TEST newprogram = 1
   SET fweight.newtablesize fweightSize
   SET ffweight.newtablesize ffweightSize
 ENDTEST
 SET raw celldata
 CALC wa = raw - offset
 CALC weight = wa * scale
 SET fweight weight
 SET ffweight fweight
 TEST sampleType = 0
   TEST staticmode = 0
		 CALC sampling = weight + dynmodeoffset
	 ELSE
		SET sampling weight
	 ENDTEST
   SET samplingmaxidx sampling.maxidx
 ELSE
   TEST sampleType = 1
		 TEST staticmode = 0
			 CALC sampling = fweight + dynmodeoffset
		 ELSE
			 SET sampling fweight
		 ENDTEST
     SET samplingmaxidx sampling.maxidx
   ELSE
		 TEST staticmode = 0
			 CALC sampling = ffweight + dynmodeoffset
		 ELSE
			 SET sampling ffweight
		 ENDTEST
     SET samplingmaxidx sampling.maxidx
   ENDTEST
 ENDTEST
END

