VERSION 2
SUB 306C14Tomat 
COUNTER restart += 1
LABEL testA
SLEEP 100
TESTEVENT Pallebane4 ST_READY_ROBOT
SUB sektion4ready
 TESTEVENT PalletAWatch ST_DIRTY
 SUB dirty
   COUNTER cAPallet += 1
   COUNTER cAItems = sAItems
   RESETPRELOAD 0
   SIGNALEVENT 1 PalletAWatch ST_CLEAN	
 END  
 TESTEVENT Tipper ST_EMPTY
 SUB TipperEmpty
  OUT 10 0
  COUNTER cAItems == 0
  SUB path47
   PPSCRIPT 306C14In idx=0,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 1
  SUB path46
   PPSCRIPT 306C14In idx=1,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 2
  SUB path45
   PPSCRIPT 306C14In idx=2,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 3
  SUB path44
   PPSCRIPT 306C14In idx=3,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 4
  SUB path43
   PPSCRIPT 306C14In idx=4,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 5
  SUB path42
   PPSCRIPT 306C14In idx=5,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 6
  SUB path41
   PPSCRIPT 306C14In idx=6,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 7
  SUB path40
   PPSCRIPT 306C14In idx=7,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 8
  SUB path39
   PPSCRIPT 306C14In idx=8,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 9
  SUB path38
   PPSCRIPT 306C14In idx=9,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 10
  SUB path37
   PPSCRIPT 306C14In idx=10,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 11
  SUB path36
   PPSCRIPT 306C14In idx=11,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 12
  SUB path35
   PPSCRIPT 306C14In idx=12,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 13
  SUB path34
   PPSCRIPT 306C14In idx=13,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 14
  SUB path33
   PPSCRIPT 306C14In idx=14,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 15
  SUB path32
   PPSCRIPT 306C14In idx=15,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 16
  SUB path31
   PPSCRIPT 306C14In idx=16,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 17
  SUB path30
   PPSCRIPT 306C14In idx=17,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 18
  SUB path29
   PPSCRIPT 306C14In idx=18,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 19
  SUB path28
   PPSCRIPT 306C14In idx=19,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 20
  SUB path27
   PPSCRIPT 306C14In idx=20,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 21
  SUB path26
   PPSCRIPT 306C14In idx=21,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 22
  SUB path25
   PPSCRIPT 306C14In idx=22,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 23
  SUB path24
   PPSCRIPT 306C14In idx=23,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 24
  SUB path23
   PPSCRIPT 306C14In idx=24,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 25
  SUB path22
   PPSCRIPT 306C14In idx=25,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 26
  SUB path21
   PPSCRIPT 306C14In idx=26,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 27
  SUB path20
   PPSCRIPT 306C14In idx=27,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 28
  SUB path19
   PPSCRIPT 306C14In idx=28,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 29
  SUB path18
   PPSCRIPT 306C14In idx=29,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 30
  SUB path17
   PPSCRIPT 306C14In idx=30,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 31
  SUB path16
   PPSCRIPT 306C14In idx=31,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 32
  SUB path15
   PPSCRIPT 306C14In idx=32,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 33
  SUB path14
   PPSCRIPT 306C14In idx=33,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 34
  SUB path13
   PPSCRIPT 306C14In idx=34,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 35
  SUB path12
   PPSCRIPT 306C14In idx=35,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 36
  SUB path11
   PPSCRIPT 306C14In idx=36,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 37
  SUB path10
   PPSCRIPT 306C14In idx=37,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 38
  SUB path9
   PPSCRIPT 306C14In idx=38,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 39
  SUB path8
   PPSCRIPT 306C14In idx=39,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 40
  SUB path7
   PPSCRIPT 306C14In idx=40,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 41
  SUB path6
   PPSCRIPT 306C14In idx=41,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 42
  SUB path5
   PPSCRIPT 306C14In idx=42,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 43
  SUB path4
   PPSCRIPT 306C14In idx=43,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 44
  SUB path3
   PPSCRIPT 306C14In idx=44,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 45
  SUB path2
   PPSCRIPT 306C14In idx=45,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 46
  SUB path1
   PPSCRIPT 306C14In idx=46,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  COUNTER cAItems == 47
  SUB path0
   PPSCRIPT 306C14In idx=47,loadgroup=0,runbopt=0
   GOTO afterEachPathA
  END
  GOTO cAItemTest
LABEL afterEachPathA
LABEL fromTipperToHome
  OUT 11 0
  OUT 10 0
  SLEEP 500
  MACRO runsavedpath 10
  SIGNALEVENT 1 Tipper ST_RESET
LABEL cAItemTest
  COUNTER delaystop = 0
  COUNTER cAItems >= wAItems
  SUB
   SIGNALEVENT 1 Pallebane4 ST_RESET
*   SIGNALEVENT 1 Pallebane4 ST_READY
  END
 END
END
*
LABEL testStation
*
TESTEVENT Station ST_EMPTY
SUB
  SIGNALEVENT 1 Station ST_TEST
  SLEEP 100
END
TESTEVENT Station ST_GET_FROM_DISPENSER
SUB StationEmpty
 TESTEVENT Dispenser ST_READY_LOWER
 SUB DispenserReadyRobot0
  OUT 11 0
  OUT 10 0
LABEL fromHomeToDispenser0
  COUNTER delaystop = 1
  MACRO runsavedpath 0
  OUT 11 1
  OUT 10 1
  SLEEP 500
LABEL fromDispenser0ToStation
  MACRO runsavedpath 2
  OUT 11 0
  OUT 10 0
  SLEEP 500
LABEL fromStationToHome
  MACRO runsavedpath 12
  SIGNALEVENT 1 Station ST_RESET
  SIGNALEVENT 1 Dispenser ST_RESET
  COUNTER delaystop = 0
  GOTO testB 
 END
 TESTEVENT Dispenser ST_READY_UPPER
 SUB DispenserReadyRobot1
  OUT 11 0
  OUT 10 0
LABEL fromHomeToDispenser1
  COUNTER delaystop = 1
  MACRO runsavedpath 1
  OUT 11 1
  OUT 10 1
  SLEEP 500
LABEL fromDispenser1ToStation
  MACRO runsavedpath 3
  OUT 11 0
  OUT 10 0
  SLEEP 500
LABEL fromStationToHome
  MACRO runsavedpath 12
  SIGNALEVENT 1 Station ST_RESET
  SIGNALEVENT 1 Dispenser ST_RESET
  COUNTER delaystop = 0
  GOTO testB 
 END
END
LABEL testB
SLEEP 100
TESTEVENT Pallebane6 ST_OK
SUB sektion6ok
  COUNTER restart > 1
  SUB
    COUNTER cBItems >= wBItems
    SUB PalleUd
      GOTO afterEachPathB
    END
    COUNTER cBItems == sBItems
    SUB
      SIGNALEVENT 1 Pallebane6 ST_READY
      GOTO testReadyRobot
    END
    SIGNALEVENT 1 Pallebane6 ST_READY_ROBOT
    GOTO testReadyRobot
  END
  SIGNALEVENT 1 Pallebane6 ST_READY
END
LABEL testReadyRobot
TESTEVENT Pallebane6 ST_READY_ROBOT
SUB sektion6readyRobot
 COUNTER cBItems >= wBItems
 SUB PalleUd
   COUNTER cBItems = sBItems
   RESETPRELOAD 1
   SIGNALEVENT 1 Pallebane6 ST_READY
   GOTO testA
 END
 TESTEVENT Buffer ST_READY
 SUB BufferReady
  TESTEVENT Station ST_READY
  SUB StationReady
LABEL fromHomeToBuffer
   COUNTER delaystop = 1
   SIGNALEVENT 1 VacuumMotor ST_SUG
   MACRO runsavedpath 5
   GOTO moveLayer 
  END
  COUNTER delaystop = 0
  GOTO testA
LABEL moveLayer
  COUNTER numOfTest = 0
LABEL liftAndTestVacuum
  SLEEP 500
  MACRO runsavedpath 7
  COUNTER numOfTest += 1
  TESTEVENT VacuumMotor ST_VACUUM_OK
  SUB VacuumOk
    GOTO flytBakker
  END
* >= 1 -> stop ved første vacuum fejl 
  COUNTER numOfTest >= 1
  SUB numOfTestStop
    SIGNALEVENT 1 VacuumMotor ST_BLOW
    SLEEP 1000 
    MACRO runsavedpath 11
    COUNTER delaystop = 0
    ERROR 100 text
    STOP
  END
LABEL sugIgen
  SIGNALEVENT 1 VacuumMotor ST_BLOW
  SLEEP 1000
  SIGNALEVENT 1 VacuumMotor ST_SUG
  MACRO runsavedpath 6
  GOTO liftAndTestVacuum
LABEL flytBakker
  MACRO runsavedpath 8
* reset først efter at bakker er i kasse
  SIGNALEVENT 1 Buffer ST_RESET
  TESTEVENT VacuumMotor ST_VACUUM_OK
  SUB VacuumOk
    GOTO pickBox
  END
  SIGNALEVENT 1 VacuumMotor ST_BLOW
  SLEEP 1000 
  MACRO runsavedpath 13
  COUNTER delaystop = 0
  ERROR 100 text
  STOP
LABEL pickBox
  SIGNALEVENT 1 VacuumMotor ST_BLOW
  OUT 11 0
  OUT 10 0
  MACRO runsavedpath 9
  SIGNALEVENT 1 VacuumMotor ST_SUG
  OUT 11 1
  OUT 10 1
LABEL moveOut
  COUNTER delaystop = 1
  COUNTER cBItems == 0
  SUB path0
   PPSCRIPT 306C14Out idx=0,loadgroup=1,runbopt=0
    GOTO afterEachPathB
  END
  COUNTER cBItems == 1
  SUB path1
   PPSCRIPT 306C14Out idx=1,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END 
  COUNTER cBItems == 2
  SUB path2
   PPSCRIPT 306C14Out idx=2,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 3
  SUB path3
   PPSCRIPT 306C14Out idx=3,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 4
  SUB path4
   PPSCRIPT 306C14Out idx=4,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 5
  SUB path5
   PPSCRIPT 306C14Out idx=5,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 6
  SUB path6
   PPSCRIPT 306C14Out idx=6,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 7
  SUB path7
   PPSCRIPT 306C14Out idx=7,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 8
  SUB path8
   PPSCRIPT 306C14Out idx=8,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 9
  SUB path9
   PPSCRIPT 306C14Out idx=9,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 10
  SUB path10
   PPSCRIPT 306C14Out idx=10,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 11
  SUB path11
   PPSCRIPT 306C14Out idx=11,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 12
  SUB path12
   PPSCRIPT 306C14Out idx=12,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 13
  SUB path13
   PPSCRIPT 306C14Out idx=13,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 14
  SUB path14
   PPSCRIPT 306C14Out idx=14,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 15
  SUB path15
   PPSCRIPT 306C14Out idx=15,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 16
  SUB path16
   PPSCRIPT 306C14Out idx=16,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 17
  SUB path17
   PPSCRIPT 306C14Out idx=17,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 18
  SUB path18
   PPSCRIPT 306C14Out idx=18,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 19
  SUB path19
   PPSCRIPT 306C14Out idx=19,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 20
  SUB path20
  PPSCRIPT 306C14Out idx=20,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 21
  SUB path21
  PPSCRIPT 306C14Out idx=21,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 22
  SUB path22
  PPSCRIPT 306C14Out idx=22,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 23
  SUB path23
  PPSCRIPT 306C14Out idx=23,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 24
  SUB path24
   PPSCRIPT 306C14Out idx=24,loadgroup=1,runbopt=0
    GOTO afterEachPathB
  END
  COUNTER cBItems == 25
  SUB path25
   PPSCRIPT 306C14Out idx=25,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END 
  COUNTER cBItems == 26
  SUB path26
   PPSCRIPT 306C14Out idx=26,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 27
  SUB path27
   PPSCRIPT 306C14Out idx=27,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 28
  SUB path28
   PPSCRIPT 306C14Out idx=28,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 29
  SUB path29
   PPSCRIPT 306C14Out idx=29,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 30
  SUB path30
   PPSCRIPT 306C14Out idx=30,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 31
  SUB path31
   PPSCRIPT 306C14Out idx=31,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 32
  SUB path32
   PPSCRIPT 306C14Out idx=32,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 33
  SUB path33
   PPSCRIPT 306C14Out idx=33,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 34
  SUB path34
   PPSCRIPT 306C14Out idx=34,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 35
  SUB path35
   PPSCRIPT 306C14Out idx=35,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 36
  SUB path36
   PPSCRIPT 306C14Out idx=36,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 37
  SUB path37
   PPSCRIPT 306C14Out idx=37,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 38
  SUB path38
   PPSCRIPT 306C14Out idx=38,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 39
  SUB path39
   PPSCRIPT 306C14Out idx=39,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 40
  SUB path40
   PPSCRIPT 306C14Out idx=40,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 41
  SUB path41
   PPSCRIPT 306C14Out idx=41,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 42
  SUB path42
   PPSCRIPT 306C14Out idx=42,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 43
  SUB path43
   PPSCRIPT 306C14Out idx=43,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 44
  SUB path44
   PPSCRIPT 306C14Out idx=44,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 45
  SUB path45
   PPSCRIPT 306C14Out idx=45,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 46
  SUB path46
   PPSCRIPT 306C14Out idx=46,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  COUNTER cBItems == 47
  SUB path47
   PPSCRIPT 306C14Out idx=47,loadgroup=1,runbopt=0
   GOTO afterEachPathB
  END
  GOTO testA
LABEL afterEachPathB
  OUT 10 0
  COUNTER cBItems >= wBItems
  SUB
   COUNTER cBPallet += 1
   COUNTER cBItems = sBItems
   RESETPRELOAD 1
   SIGNALEVENT 1 Pallebane6 ST_READY
  END
 END
END
GOTO testA
END
