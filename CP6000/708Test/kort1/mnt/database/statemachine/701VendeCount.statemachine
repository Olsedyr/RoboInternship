STATEMACHINEVERSION 3
Name=VendeCount
Link=VendeStation
Link=VendeStation2
Link=VendePattern
Link=foto1 Vende1Foto1
Link=foto2 Vende2Foto1
Link=fotosync1 FotoSync1
Link=parent Parent
linkValue=firstRun WorkCell
linkValue=numpercycle VendePattern
linkValue=productsfromleft Program
linkValue=productsfromright Program
linkValue=totcount ProductCount
Value=numofproducts 0
Timeout=TimeGoIdle 500000

State=ST_TIMER
END

State=ST_HALT
END

State=ST_IDLE
	TEST parent = ST_RESET
		SETSTATE ST_RESET
	ENDTEST
END

State=ST_RESET
	TEST firstRun = 1
		SET numofproducts 0
	ENDTEST
	TEST VendeStation = ST_RUN
	AND productsfromright = 1
		SETSTATE ST_RUN1
	ELSE
		TEST VendeStation2 = ST_RUN
		AND productsfromleft = 1
			SETSTATE ST_RUN2
		ENDTEST
	ENDTEST
END

State=ST_RUN1
	TEST foto1 = ST_LOW
		CALC numofproducts = numofproducts % numpercycle
		CALC numofproducts = numofproducts + 1
	ELSE
		TEST fotosync1 = ST_SYNC
			CALC numofproducts = totcount % numpercycle
		ENDTEST
	ENDTEST
	TEST VendeStation = ST_IDLE
		TIMEOUT TimeGoIdle ST_GOIDLE1
		SETSTATE ST_GOIDLE1
	ENDTEST
END

State=ST_RUN2
	TEST foto2 = ST_LOW
		CALC numofproducts = numofproducts % numpercycle
		CALC numofproducts = numofproducts + 1
	ENDTEST
	TEST VendeStation2 = ST_IDLE
		TIMEOUT TimeGoIdle ST_GOIDLE2
		SETSTATE ST_GOIDLE2
	ENDTEST
END

State=ST_GOIDLE1
	TEST foto1 = ST_LOW
		CALC numofproducts = numofproducts % numpercycle
		CALC numofproducts = numofproducts + 1
	ENDTEST
	TEST TimeGoIdle = 1
		SETSTATE ST_IDLE
	ENDTEST
END

State=ST_GOIDLE2
	TEST foto2 = ST_LOW
		CALC numofproducts = numofproducts % numpercycle
		CALC numofproducts = numofproducts + 1
	ENDTEST
	TEST TimeGoIdle = 1
		SETSTATE ST_IDLE
	ENDTEST
END
