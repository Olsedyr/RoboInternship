STATEMACHINEVERSION 3
Name=CPCounter
Link=foto1 Product1Foto1
Link=foto2 Product2Foto1
Link=parent Parent
linkValue=firstRun WorkCell
linkValue=productsfromleft Program
linkValue=productsfromright Program
Table=avgtime 20.0 AVG
Value=curt 0
Value=temp 0.0
Value=temp2 0.0
Value=now 0.0
Value=avg 0.0
Value=avgtimetol 0.0
Value=prodpermin 0.0
Timeout=MinTime 30000000

State=ST_HALT
END

State=ST_TIMER
END

State=ST_IDLE
	TEST parent = ST_RESET
		SETSTATE ST_RESET
	ENDTEST
END

State=ST_RESET
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avgtime 600.0
	SET avg 600.0
	SET prodpermin 0.0
	TEST productsfromleft = 1
	AND productsfromright = 1
    TIMEOUT MinTime ST_COUNT1
		SETSTATE ST_COUNT1
  ELSE
	  TEST productsfromleft = 1
		  TIMEOUT MinTime ST_COUNT2
		  SETSTATE ST_COUNT2
	  ELSE
		  TEST productsfromright = 1
			  TIMEOUT MinTime ST_COUNT3
			  SETSTATE ST_COUNT3
		  ELSE
			  SETSTATE ST_IDLE
		  ENDTEST
	  ENDTEST
  ENDTEST
END

State=ST_COUNT1
	SET curt MinTime
	CALC curt = MinTime - curt
	CALC now = curt / 1000000.0
	TEST foto1 = ST_LOW
  AND foto2 = ST_LOW
		TIMEOUT MinTime ST_COUNT1
		SETSTATE ST_COUNT1
		SET avgtime now
		SET avgtime now
		SET avg avgtime
	ELSE
	  TEST foto1 = ST_LOW
		  TIMEOUT MinTime ST_COUNT1
		  SETSTATE ST_COUNT1
		  SET avgtime now
		  SET avg avgtime
	  ELSE
	    TEST foto2 = ST_LOW
		    TIMEOUT MinTime ST_COUNT1
		    SETSTATE ST_COUNT1
		    SET avgtime now
		    SET avg avgtime
	    ELSE
		    TEST MinTime = 1
			    SET avg 600.0
			    SETSTATE ST_RESET
		    ELSE
			    SET avg avgtime
		    ENDTEST
	    ENDTEST
    ENDTEST
  ENDTEST
	CALC prodpermin = 60.0 / avg
	TEST parent = ST_IDLE
		SETSTATE ST_IDLE
	ENDTEST
END

State=ST_COUNT2
	SET curt MinTime
	CALC curt = MinTime - curt
	CALC now = curt / 1000000.0
	TEST foto1 = ST_LOW
		TIMEOUT MinTime ST_COUNT2
		SETSTATE ST_COUNT2
		SET avgtime now
		SET avg avgtime
	ELSE
		TEST MinTime = 1
			SET avg 600.0
			SETSTATE ST_RESET
		ELSE
			SET avg avgtime
		ENDTEST
	ENDTEST
	CALC prodpermin = 60.0 / avg
	TEST parent = ST_IDLE
		SETSTATE ST_IDLE
	ENDTEST
END

State=ST_COUNT3
	SET curt MinTime
	CALC curt = MinTime - curt
	CALC now = curt / 1000000.0
	TEST foto2 = ST_LOW
		TIMEOUT MinTime ST_COUNT3
		SETSTATE ST_COUNT3
		SET avgtime now
		SET avg avgtime
	ELSE
		TEST MinTime = 1
			SET avg 600.0
			SETSTATE ST_RESET
		ELSE
			SET avg avgtime
		ENDTEST
	ENDTEST
	CALC prodpermin = 60.0 / avg
	TEST parent = ST_IDLE
		SETSTATE ST_IDLE
	ENDTEST
END
