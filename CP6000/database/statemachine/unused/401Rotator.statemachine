STATEMACHINEVERSION 3
Name=Rotator
Input=powerok1 "ProductConveyor1 HZOK"
Input=powerok2 "ProductConveyor2 HZOK"
Output=Motor1Enable "ProductConveyor1 Motor Enable"
Output=Motor2Enable "ProductConveyor2 Motor Enable"
Output=Setpoint1 "RotatorLeft Setpoint"
Output=Setpoint2 "RotatorRight Setpoint"
Link=next ConveyorOut
Link=foto RotatePhoto2
Link=parent Parent
Value=simulate 0
Const=motorLeft -40.0000
Const=motorRight 40.0000
Timeout=StartDelay 1000000
Timeout=timeActive 4000000

State=ST_TIMER
END

State=ST_HALT
END

State=ST_IDLE
	SET Motor1Enable 0
	SET Motor2Enable 0
	SET Setpoint1 motorLeft
	SET Setpoint2 motorRight
  TEST next = ST_FIND_ITEM
  OR simulate = 1
		TIMEOUT StartDelay ST_RESET
    SETSTATE ST_TIMER
  ENDTEST
END

State=ST_FIND_ITEM
  TEST foto = ST_BLOCKED
		TEST next = ST_FIND_ITEM
			TIMEOUT timeActive ST_RUN
			SETSTATE ST_RUN
		ELSE
			SETSTATE ST_PAUSE
		ENDTEST
  ELSE
		SET Motor1Enable 1
		SET Motor2Enable 1
  ENDTEST
	TEST parent = ST_IDLE
  AND simulate = 0
    SETSTATE ST_IDLE
  ENDTEST
END

State=ST_PAUSE
	SET Motor1Enable 0
	SET Motor2Enable 0
	TEST next = ST_FIND_ITEM
		TIMEOUT timeActive ST_RUN
		SETSTATE ST_RUN
	ENDTEST
	TEST parent = ST_IDLE
  AND simulate = 0
    SETSTATE ST_IDLE
  ENDTEST
END

State=ST_RUN
	SET Motor1Enable 1
	SET Motor2Enable 1
	TEST next = ST_READY_ROBOT
	OR timeActive = 1
		SETSTATE ST_FIND_ITEM
  ENDTEST
END

State=ST_RESET
  SETSTATE ST_FIND_ITEM
END
