STATEMACHINEVERSION 2
Name=Tipper
Delaystop=10000000
Input=0,Foto1 "Tipper Foto1"
Input=1,Foto2 "Tipper Foto2"
Input=2,ReedUp "Tipper CylTip+"
Input=3,ReedDwn "Tipper CylTip-"
Input=4,KlarTip "Weight Ready"
Output=0,CylTip "Tipper CylTip"
Output=1,CylHold "Tipper CylHold"
Output=2,Motor "Tipper Motor"
Output=3,MotorRev "Tipper MotorRev"
Output=4,SkubKasse "Station SkubKasse"
Timeout=0,StopDelay 1000000
Timeout=1,MotorRevTimeout 3500000
Timeout=2,TipTimeout 1000000
Timeout=3,SmallTipTimeout1 1000000
Timeout=4,SmallTipTimeout2 500000
Timeout=5,SkubDelay 700000
Link=0,Station
Link=1,WorkCell

State=0,ST_HALT
  END

State=0,ST_TIMER
  END

State=0,ST_IDLE
  SET Motor 0
  SET MotorRev 0
  SET CylTip 0
  SET CylHold 0
  SET SkubKasse 0
  END

State=0,ST_READY
  TEST Station = ST_EMPTY
	  SETSTATE ST_SEND
	ELSE
	  SET Motor 0
	ENDTEST
  TEST WorkCell = ST_IDLE
  OR WorkCell = ST_PAUSED
  OR WorkCell = ST_PAUSING
  OR WorkCell = ST_STOPPING
    SETSTATE ST_IDLE
  ENDTEST
	END
	
State=0,ST_SEND
  TEST Station = ST_READY
	  SETSTATE ST_EMPTY
	ELSE
	  SET Motor 1
	ENDTEST
	END
	
State=0,ST_EMPTY
	SET Motor 0
	SET MotorRev 0
  TEST WorkCell = ST_IDLE
  OR WorkCell = ST_PAUSED
  OR WorkCell = ST_PAUSING
  OR WorkCell = ST_STOPPING
    SETSTATE ST_IDLE
  ENDTEST
	END
	
State=0,ST_PUSH
  SET SkubKasse 1
  TIMEOUT SkubDelay ST_PUSH1
  SETSTATE ST_PUSH1
  END

State=0,ST_PUSH1
  TEST SkubDelay = 1
    SETSTATE ST_LOAD
  ENDTEST
  END

State=0,ST_LOAD
  SET SkubKasse 0
  TEST ReedDwn = 1
    SET MotorRev 1
    TEST Foto1 = 1
      TIMEOUT MotorRevTimeout ST_TIP_UP
      SETSTATE ST_TIMER
    ENDTEST
    TEST WorkCell = ST_IDLE
    OR WorkCell = ST_PAUSED
    OR WorkCell = ST_PAUSING
    OR WorkCell = ST_STOPPING
      SETSTATE ST_IDLE
    ENDTEST
  ELSE
    SET CylTip 0
  ENDTEST
  END
	
State=1,ST_RESET
  SET SkubKasse 0
  TEST Foto1 = 1
  OR Foto2 = 1
    SETSTATE ST_PUSH
	ELSE
	  SETSTATE ST_EMPTY
	ENDTEST
	END

State=0,ST_TIP_UP
  SET MotorRev 0
  SET Motor 0
  SET CylHold 1
  TEST KlarTip = 0
	  SET CylTip 1
	  TEST ReedUp = 1
      TEST KlarTip = 0
	      SET CylTip 0
		    TIMEOUT SmallTipTimeout1 ST_TIP_UP_2
		    SETSTATE ST_TIMER
      ENDTEST
	  ENDTEST
  ENDTEST
  TEST WorkCell = ST_IDLE
  OR WorkCell = ST_PAUSED
  OR WorkCell = ST_PAUSING
  OR WorkCell = ST_STOPPING
    SETSTATE ST_TIP_DOWN
  ENDTEST
	END

State=0,ST_TIP_UP_2
  SET MotorRev 0
	SET Motor 0
	SET CylHold 1
	SET CylTip 1
	TEST ReedUp = 1
    TEST KlarTip = 0
		  SET CylTip 0
		  TIMEOUT SmallTipTimeout2 ST_TIP_UP_3
		  SETSTATE ST_TIMER
	  ENDTEST
	ENDTEST
  TEST WorkCell = ST_IDLE
  OR WorkCell = ST_PAUSED
  OR WorkCell = ST_PAUSING
  OR WorkCell = ST_STOPPING
    SETSTATE ST_TIP_DOWN
  ENDTEST
	END

State=0,ST_TIP_UP_3
  SET MotorRev 0
	SET Motor 0
	SET CylHold 1
	SET CylTip 1
	TEST ReedUp = 1
		TIMEOUT TipTimeout ST_TIP_DOWN
		SETSTATE ST_TIMER
	ENDTEST
  TEST WorkCell = ST_IDLE
  OR WorkCell = ST_PAUSED
  OR WorkCell = ST_PAUSING
  OR WorkCell = ST_STOPPING
    SETSTATE ST_TIP_DOWN
  ENDTEST
	END

State=0,ST_TIP_DOWN
  SET MotorRev 0
	SET Motor 0
	SET CylHold 1
	SET CylTip 0 
	TEST ReedDwn = 1
	  SET CylHold 0
		TEST Foto2 = 0
		  TEST Foto1 = 1
        SET Motor 1
		    SETSTATE ST_RECIEVE
      ELSE
        SETSTATE ST_EMPTY
		  ENDTEST
    ENDTEST
    TEST WorkCell = ST_IDLE
    OR WorkCell = ST_PAUSED
    OR WorkCell = ST_PAUSING
    OR WorkCell = ST_STOPPING
      SETSTATE ST_IDLE
    ENDTEST
	ENDTEST
	END
	
State=0,ST_RECIEVE
	TEST Foto2 = 1
	  TIMEOUT StopDelay ST_READY
		SETSTATE ST_TIMER
	ENDTEST
;errorCode if box never arrives
	END
		
