STATEMACHINEVERSION 2
Name=KassePakkerMotor
Delaystop=5000000
Input=0,Printstop "PrinterStop"
Output=0,Skubbepladsmotor "KassePakker skubbePladsMotor"
Link=0,KassePakkerTop
Link=1,UniChain
Timeout=0,MaxWaitFull 600000
Timeout=1,MaxWaitPrintStop 8000000

State=0,ST_TIMER
END

State=0,ST_HALT
END

State=0,ST_IDLE
  SET Skubbepladsmotor 0
END

State=1,ST_RUN
  TEST UniChain = ST_NOPRODUCTS
    SET Skubbepladsmotor 0
    SETSTATE ST_STOPNP
  ELSE  
    TEST UniChain = ST_STOP
    AND Printstop = 1
      TIMEOUT MaxWaitPrintStop ST_STOPPRINT
      SETSTATE ST_STOPPRINT 
    ELSE
      TEST KassePakkerTop = ST_FULL
        TIMEOUT MaxWaitFull ST_STOPTEST
        SETSTATE ST_STOPTEST    
      ENDTEST
    ENDTEST
  ENDTEST
  TEST KassePakkerTop = ST_IDLE
    SETSTATE ST_IDLE
  ENDTEST
END

State=1,ST_STOPTEST
  TEST KassePakkerTop != ST_FULL
    SETSTATE ST_RUN
  ELSE
    TEST MaxWaitFull = 1
      SET Skubbepladsmotor 0
      SETSTATE ST_STOP
    ENDTEST
  ENDTEST
END
 
State=1,ST_STOPNP
  TEST UniChain != ST_NOPRODUCTS
    SET Skubbepladsmotor 1
    SETSTATE ST_RUN
  ENDTEST
  TEST KassePakkerTop = ST_IDLE
    SETSTATE ST_IDLE
  ENDTEST
END

State=1,ST_STOPPRINT
  TEST MaxWaitPrintStop = 1
    SET Skubbepladsmotor 0
  ENDTEST
  TEST Printstop = 0
    SET Skubbepladsmotor 1
    SETSTATE ST_RUN
  ENDTEST
  TEST KassePakkerTop = ST_IDLE
    SETSTATE ST_IDLE
  ENDTEST
END

State=1,ST_STOP
  TEST KassePakkerTop != ST_FULL
    SET Skubbepladsmotor 1
    SETSTATE ST_RUN
  ENDTEST
  TEST KassePakkerTop = ST_IDLE
    SETSTATE ST_IDLE
  ENDTEST
END

State=5,ST_RESET
  SET Skubbepladsmotor 1
  SETSTATE ST_RUN
END
